[{"data":1,"prerenderedAt":1337},["Reactive",2],{"page-data":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"date":10,"draft":6,"tags":11,"categories":14,"excerpt":16,"body":26,"_type":1331,"_id":1332,"_source":1333,"_file":1334,"_stem":1335,"_extension":1336},"/articles/persistent-archlinux-usb","articles",false,"","Create a Persistent Arch Linux Bootable USB with Vagrant","When installing a linux distribution, it is common for the instructions to have\nthe user create a bootable USB, boot from the device, and proceed with the\ninstallation procedure from that live medium. However, this blog post will\noutline an alternative approach where a virtual machine created with Vagrant\nwill be used in favor of the live medium.","2020-01-09",[12,13],"vagrant","archlinux",[15],"linux",{"type":17,"children":18},"root",[19],{"type":20,"tag":21,"props":22,"children":23},"element","p",{},[24],{"type":25,"value":9},"text",{"type":17,"children":27,"toc":1320},[28,32,39,85,91,98,115,152,165,190,246,354,367,388,654,660,674,681,705,825,831,846,885,908,941,947,1002,1067,1073,1081,1089,1097,1120,1128,1133,1138,1144,1174,1204,1210,1314],{"type":20,"tag":21,"props":29,"children":30},{},[31],{"type":25,"value":9},{"type":20,"tag":33,"props":34,"children":36},"h1",{"id":35},"preface",[37],{"type":25,"value":38},"Preface",{"type":20,"tag":21,"props":40,"children":41},{},[42,44,51,53,83],{"type":25,"value":43},"The original intention was to use Docker for this process -- leveraging the\n",{"type":20,"tag":45,"props":46,"children":48},"code",{"className":47},[],[49],{"type":25,"value":50},"--device",{"type":25,"value":52}," flag and mounting the target USB device in the Docker container,\nbut the underlying hypervisor in Docker Desktop for Mac does not support this.\n",{"type":20,"tag":54,"props":55,"children":56},"sup",{},[57,66,68,75,76],{"type":20,"tag":58,"props":59,"children":63},"a",{"href":60,"rel":61},"https://docs.docker.com/docker-for-mac/docker-toolbox/",[62],"nofollow",[64],{"type":25,"value":65},"1",{"type":25,"value":67}," ",{"type":20,"tag":58,"props":69,"children":72},{"href":70,"rel":71},"https://github.com/moby/hyperkit",[62],[73],{"type":25,"value":74},"2",{"type":25,"value":67},{"type":20,"tag":58,"props":77,"children":80},{"href":78,"rel":79},"https://github.com/docker/for-mac/issues/900",[62],[81],{"type":25,"value":82},"3",{"type":25,"value":84}," While there are workarounds using Docker\nMachine, Vagrant felt like the path of least resistance.",{"type":20,"tag":33,"props":86,"children":88},{"id":87},"instructions",[89],{"type":25,"value":90},"Instructions",{"type":20,"tag":92,"props":93,"children":95},"h2",{"id":94},"create-an-arch-linux-virtual-machine-with-vagrant",[96],{"type":25,"value":97},"Create an Arch Linux Virtual Machine with Vagrant",{"type":20,"tag":21,"props":99,"children":100},{},[101,103,113],{"type":25,"value":102},"Get the latest Arch Linux image ",{"type":20,"tag":54,"props":104,"children":105},{},[106],{"type":20,"tag":58,"props":107,"children":110},{"href":108,"rel":109},"https://app.vagrantup.com/archlinux/boxes/archlinux",[62],[111],{"type":25,"value":112},"4",{"type":25,"value":114}," from the Vagrant Cloud Box\nCatalog.",{"type":20,"tag":116,"props":117,"children":121},"pre",{"code":118,"language":119,"meta":7,"className":120,"style":7},"vagrant box add archlinux/archlinux\n","bash","language-bash shiki shiki-themes github-light",[122],{"type":20,"tag":45,"props":123,"children":124},{"__ignoreMap":7},[125],{"type":20,"tag":126,"props":127,"children":130},"span",{"class":128,"line":129},"line",1,[131,136,142,147],{"type":20,"tag":126,"props":132,"children":134},{"style":133},"--shiki-default:#6F42C1",[135],{"type":25,"value":12},{"type":20,"tag":126,"props":137,"children":139},{"style":138},"--shiki-default:#032F62",[140],{"type":25,"value":141}," box",{"type":20,"tag":126,"props":143,"children":144},{"style":138},[145],{"type":25,"value":146}," add",{"type":20,"tag":126,"props":148,"children":149},{"style":138},[150],{"type":25,"value":151}," archlinux/archlinux\n",{"type":20,"tag":21,"props":153,"children":154},{},[155,157,163],{"type":25,"value":156},"Determine the USB vendor information for the thumb-drive that we will\npass-through to the virtual machine. Using the ",{"type":20,"tag":45,"props":158,"children":160},{"className":159},[],[161],{"type":25,"value":162},"VBoxManage",{"type":25,"value":164}," utility that comes\nwith Virtual Box, list the devices, and make note of the Vendor and Product ID.",{"type":20,"tag":116,"props":166,"children":168},{"code":167,"language":119,"meta":7,"className":120,"style":7}," VBoxManage list usbhost\n",[169],{"type":20,"tag":45,"props":170,"children":171},{"__ignoreMap":7},[172],{"type":20,"tag":126,"props":173,"children":174},{"class":128,"line":129},[175,180,185],{"type":20,"tag":126,"props":176,"children":177},{"style":133},[178],{"type":25,"value":179}," VBoxManage",{"type":20,"tag":126,"props":181,"children":182},{"style":138},[183],{"type":25,"value":184}," list",{"type":20,"tag":126,"props":186,"children":187},{"style":138},[188],{"type":25,"value":189}," usbhost\n",{"type":20,"tag":21,"props":191,"children":192},{},[193,195,201,203,209,211,229,231,237,239,244],{"type":25,"value":194},"Create a ",{"type":20,"tag":45,"props":196,"children":198},{"className":197},[],[199],{"type":25,"value":200},"Vagrantfile",{"type":25,"value":202}," with ",{"type":20,"tag":45,"props":204,"children":206},{"className":205},[],[207],{"type":25,"value":208},"archlinx/archlinux",{"type":25,"value":210}," as the target box, and the USB\ndevice information that is passed through. ",{"type":20,"tag":54,"props":212,"children":213},{},[214,221,222],{"type":20,"tag":58,"props":215,"children":218},{"href":216,"rel":217},"https://antonyjepson.wordpress.com/2012/01/26/quickly-attaching-usb-devices-to-virtualbox-guests-using-vboxmanage/",[62],[219],{"type":25,"value":220},"5",{"type":25,"value":67},{"type":20,"tag":58,"props":223,"children":226},{"href":224,"rel":225},"https://gist.github.com/dscape/7d829c0c116ef419f963",[62],[227],{"type":25,"value":228},"6",{"type":25,"value":230}," Vagrant\noffers a handy customization parameter ",{"type":20,"tag":45,"props":232,"children":234},{"className":233},[],[235],{"type":25,"value":236},"vb.customize",{"type":25,"value":238}," that calls the\n",{"type":20,"tag":45,"props":240,"children":242},{"className":241},[],[243],{"type":25,"value":162},{"type":25,"value":245}," command under-the-hood, allowing one to enable the guest machine\nto access the host machine's USB devices.",{"type":20,"tag":116,"props":247,"children":251},{"code":248,"language":249,"meta":7,"className":250,"style":7},"# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n  config.vm.box = \"archlinux/archlinux\"\n  config.vm.provider \"virtualbox\" do |vb|\n    vb.name = \"archlinux\"\n    vb.customize ['modifyvm', :id, '--usb', 'on']\n    vb.customize ['usbfilter', 'add', '1', '--target', :id, '--name', 'SanDisk Ultra Fit', '--vendorid', '0x0781', '--productid', '0x5583']\n  end\nend\n","txt","language-txt shiki shiki-themes github-light",[252],{"type":20,"tag":45,"props":253,"children":254},{"__ignoreMap":7},[255,263,272,282,291,300,309,318,327,336,345],{"type":20,"tag":126,"props":256,"children":257},{"class":128,"line":129},[258],{"type":20,"tag":126,"props":259,"children":260},{},[261],{"type":25,"value":262},"# -*- mode: ruby -*-\n",{"type":20,"tag":126,"props":264,"children":266},{"class":128,"line":265},2,[267],{"type":20,"tag":126,"props":268,"children":269},{},[270],{"type":25,"value":271},"# vi: set ft=ruby :\n",{"type":20,"tag":126,"props":273,"children":275},{"class":128,"line":274},3,[276],{"type":20,"tag":126,"props":277,"children":279},{"emptyLinePlaceholder":278},true,[280],{"type":25,"value":281},"\n",{"type":20,"tag":126,"props":283,"children":285},{"class":128,"line":284},4,[286],{"type":20,"tag":126,"props":287,"children":288},{},[289],{"type":25,"value":290},"Vagrant.configure(\"2\") do |config|\n",{"type":20,"tag":126,"props":292,"children":294},{"class":128,"line":293},5,[295],{"type":20,"tag":126,"props":296,"children":297},{},[298],{"type":25,"value":299},"  config.vm.box = \"archlinux/archlinux\"\n",{"type":20,"tag":126,"props":301,"children":303},{"class":128,"line":302},6,[304],{"type":20,"tag":126,"props":305,"children":306},{},[307],{"type":25,"value":308},"  config.vm.provider \"virtualbox\" do |vb|\n",{"type":20,"tag":126,"props":310,"children":312},{"class":128,"line":311},7,[313],{"type":20,"tag":126,"props":314,"children":315},{},[316],{"type":25,"value":317},"    vb.name = \"archlinux\"\n",{"type":20,"tag":126,"props":319,"children":321},{"class":128,"line":320},8,[322],{"type":20,"tag":126,"props":323,"children":324},{},[325],{"type":25,"value":326},"    vb.customize ['modifyvm', :id, '--usb', 'on']\n",{"type":20,"tag":126,"props":328,"children":330},{"class":128,"line":329},9,[331],{"type":20,"tag":126,"props":332,"children":333},{},[334],{"type":25,"value":335},"    vb.customize ['usbfilter', 'add', '1', '--target', :id, '--name', 'SanDisk Ultra Fit', '--vendorid', '0x0781', '--productid', '0x5583']\n",{"type":20,"tag":126,"props":337,"children":339},{"class":128,"line":338},10,[340],{"type":20,"tag":126,"props":341,"children":342},{},[343],{"type":25,"value":344},"  end\n",{"type":20,"tag":126,"props":346,"children":348},{"class":128,"line":347},11,[349],{"type":20,"tag":126,"props":350,"children":351},{},[352],{"type":25,"value":353},"end\n",{"type":20,"tag":21,"props":355,"children":356},{},[357,359,365],{"type":25,"value":358},"When virtual machine is brought up, the ",{"type":20,"tag":45,"props":360,"children":362},{"className":361},[],[363],{"type":25,"value":364},"usbfilter",{"type":25,"value":366}," is applied, and the guest\nis able to access to the host machine's USB device that was specified in the\nfilter.",{"type":20,"tag":21,"props":368,"children":369},{},[370,372,378,380,386],{"type":25,"value":371},"Start the machine, ",{"type":20,"tag":45,"props":373,"children":375},{"className":374},[],[376],{"type":25,"value":377},"ssh",{"type":25,"value":379}," into the guest, and list the devices to confirm that\nthe USB device is available (see: ",{"type":20,"tag":45,"props":381,"children":383},{"className":382},[],[384],{"type":25,"value":385},"/dev/sdb",{"type":25,"value":387},").",{"type":20,"tag":116,"props":389,"children":391},{"code":390,"language":119,"meta":7,"className":120,"style":7},"$ vagrant up\n$ vagrant ssh\n[vagrant@archlinux ~]$ lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda      8:0    0   20G  0 disk\n├─sda1   8:1    0  1.9G  0 part [SWAP]\n└─sda2   8:2    0 18.1G  0 part /\nsdb      8:16   1 28.7G  0 disk\n└─sdb1   8:17   1    8G  0 part\n",[392],{"type":20,"tag":45,"props":393,"children":394},{"__ignoreMap":7},[395,413,429,449,487,521,557,592,623],{"type":20,"tag":126,"props":396,"children":397},{"class":128,"line":129},[398,403,408],{"type":20,"tag":126,"props":399,"children":400},{"style":133},[401],{"type":25,"value":402},"$",{"type":20,"tag":126,"props":404,"children":405},{"style":138},[406],{"type":25,"value":407}," vagrant",{"type":20,"tag":126,"props":409,"children":410},{"style":138},[411],{"type":25,"value":412}," up\n",{"type":20,"tag":126,"props":414,"children":415},{"class":128,"line":265},[416,420,424],{"type":20,"tag":126,"props":417,"children":418},{"style":133},[419],{"type":25,"value":402},{"type":20,"tag":126,"props":421,"children":422},{"style":138},[423],{"type":25,"value":407},{"type":20,"tag":126,"props":425,"children":426},{"style":138},[427],{"type":25,"value":428}," ssh\n",{"type":20,"tag":126,"props":430,"children":431},{"class":128,"line":274},[432,438,444],{"type":20,"tag":126,"props":433,"children":435},{"style":434},"--shiki-default:#24292E",[436],{"type":25,"value":437},"[vagrant@archlinux ",{"type":20,"tag":126,"props":439,"children":441},{"style":440},"--shiki-default:#D73A49",[442],{"type":25,"value":443},"~",{"type":20,"tag":126,"props":445,"children":446},{"style":434},[447],{"type":25,"value":448},"]$ lsblk\n",{"type":20,"tag":126,"props":450,"children":451},{"class":128,"line":284},[452,457,462,467,472,477,482],{"type":20,"tag":126,"props":453,"children":454},{"style":133},[455],{"type":25,"value":456},"NAME",{"type":20,"tag":126,"props":458,"children":459},{"style":138},[460],{"type":25,"value":461},"   MAJ:MIN",{"type":20,"tag":126,"props":463,"children":464},{"style":138},[465],{"type":25,"value":466}," RM",{"type":20,"tag":126,"props":468,"children":469},{"style":138},[470],{"type":25,"value":471},"  SIZE",{"type":20,"tag":126,"props":473,"children":474},{"style":138},[475],{"type":25,"value":476}," RO",{"type":20,"tag":126,"props":478,"children":479},{"style":138},[480],{"type":25,"value":481}," TYPE",{"type":20,"tag":126,"props":483,"children":484},{"style":138},[485],{"type":25,"value":486}," MOUNTPOINT\n",{"type":20,"tag":126,"props":488,"children":489},{"class":128,"line":293},[490,495,500,506,511,516],{"type":20,"tag":126,"props":491,"children":492},{"style":133},[493],{"type":25,"value":494},"sda",{"type":20,"tag":126,"props":496,"children":497},{"style":138},[498],{"type":25,"value":499},"      8:0",{"type":20,"tag":126,"props":501,"children":503},{"style":502},"--shiki-default:#005CC5",[504],{"type":25,"value":505},"    0",{"type":20,"tag":126,"props":507,"children":508},{"style":138},[509],{"type":25,"value":510},"   20G",{"type":20,"tag":126,"props":512,"children":513},{"style":502},[514],{"type":25,"value":515},"  0",{"type":20,"tag":126,"props":517,"children":518},{"style":138},[519],{"type":25,"value":520}," disk\n",{"type":20,"tag":126,"props":522,"children":523},{"class":128,"line":302},[524,529,534,538,543,547,552],{"type":20,"tag":126,"props":525,"children":526},{"style":133},[527],{"type":25,"value":528},"├─sda1",{"type":20,"tag":126,"props":530,"children":531},{"style":138},[532],{"type":25,"value":533},"   8:1",{"type":20,"tag":126,"props":535,"children":536},{"style":502},[537],{"type":25,"value":505},{"type":20,"tag":126,"props":539,"children":540},{"style":138},[541],{"type":25,"value":542},"  1.9G",{"type":20,"tag":126,"props":544,"children":545},{"style":502},[546],{"type":25,"value":515},{"type":20,"tag":126,"props":548,"children":549},{"style":138},[550],{"type":25,"value":551}," part",{"type":20,"tag":126,"props":553,"children":554},{"style":434},[555],{"type":25,"value":556}," [SWAP]\n",{"type":20,"tag":126,"props":558,"children":559},{"class":128,"line":311},[560,565,570,574,579,583,587],{"type":20,"tag":126,"props":561,"children":562},{"style":133},[563],{"type":25,"value":564},"└─sda2",{"type":20,"tag":126,"props":566,"children":567},{"style":138},[568],{"type":25,"value":569},"   8:2",{"type":20,"tag":126,"props":571,"children":572},{"style":502},[573],{"type":25,"value":505},{"type":20,"tag":126,"props":575,"children":576},{"style":138},[577],{"type":25,"value":578}," 18.1G",{"type":20,"tag":126,"props":580,"children":581},{"style":502},[582],{"type":25,"value":515},{"type":20,"tag":126,"props":584,"children":585},{"style":138},[586],{"type":25,"value":551},{"type":20,"tag":126,"props":588,"children":589},{"style":138},[590],{"type":25,"value":591}," /\n",{"type":20,"tag":126,"props":593,"children":594},{"class":128,"line":320},[595,600,605,610,615,619],{"type":20,"tag":126,"props":596,"children":597},{"style":133},[598],{"type":25,"value":599},"sdb",{"type":20,"tag":126,"props":601,"children":602},{"style":138},[603],{"type":25,"value":604},"      8:16",{"type":20,"tag":126,"props":606,"children":607},{"style":502},[608],{"type":25,"value":609},"   1",{"type":20,"tag":126,"props":611,"children":612},{"style":138},[613],{"type":25,"value":614}," 28.7G",{"type":20,"tag":126,"props":616,"children":617},{"style":502},[618],{"type":25,"value":515},{"type":20,"tag":126,"props":620,"children":621},{"style":138},[622],{"type":25,"value":520},{"type":20,"tag":126,"props":624,"children":625},{"class":128,"line":329},[626,631,636,640,645,649],{"type":20,"tag":126,"props":627,"children":628},{"style":133},[629],{"type":25,"value":630},"└─sdb1",{"type":20,"tag":126,"props":632,"children":633},{"style":138},[634],{"type":25,"value":635},"   8:17",{"type":20,"tag":126,"props":637,"children":638},{"style":502},[639],{"type":25,"value":609},{"type":20,"tag":126,"props":641,"children":642},{"style":138},[643],{"type":25,"value":644},"    8G",{"type":20,"tag":126,"props":646,"children":647},{"style":502},[648],{"type":25,"value":515},{"type":20,"tag":126,"props":650,"children":651},{"style":138},[652],{"type":25,"value":653}," part\n",{"type":20,"tag":92,"props":655,"children":657},{"id":656},"install-arch-linux-on-the-usb-drive",[658],{"type":25,"value":659},"Install Arch Linux on the USB Drive",{"type":20,"tag":21,"props":661,"children":662},{},[663,665,672],{"type":25,"value":664},"The ",{"type":20,"tag":58,"props":666,"children":669},{"href":667,"rel":668},"https://wiki.archlinux.org/index.php/Installation_guide",[62],[670],{"type":25,"value":671},"Arch Linux Installation Guide",{"type":25,"value":673}," outlines the installation procedure in\ngreat detail -- the following steps follow this closely with a few alteration\ndue to installing onto removable media.",{"type":20,"tag":675,"props":676,"children":678},"h3",{"id":677},"partition-the-disk-uefi-with-gpt",[679],{"type":25,"value":680},"Partition the Disk (UEFI with GPT)",{"type":20,"tag":116,"props":682,"children":684},{"code":683,"language":119,"meta":7,"className":120,"style":7},"[root@archlinux ~]# fdisk /dev/sdb\n",[685],{"type":20,"tag":45,"props":686,"children":687},{"__ignoreMap":7},[688],{"type":20,"tag":126,"props":689,"children":690},{"class":128,"line":129},[691,696,700],{"type":20,"tag":126,"props":692,"children":693},{"style":434},[694],{"type":25,"value":695},"[root@archlinux ",{"type":20,"tag":126,"props":697,"children":698},{"style":440},[699],{"type":25,"value":443},{"type":20,"tag":126,"props":701,"children":702},{"style":434},[703],{"type":25,"value":704},"]# fdisk /dev/sdb\n",{"type":20,"tag":116,"props":706,"children":708},{"code":707,"language":249,"meta":7,"className":250,"style":7},"Command (m for help): p\nDisk /dev/sdb: 28.66 GiB, 30752636928 bytes, 60063744 sectors\nDisk model: Ultra Fit\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisklabel type: gpt\nDisk identifier: E1D6C445-1B79-AB4D-A442-FA4AD6DF4ECC\n\nDevice       Start      End  Sectors  Size Type\n/dev/sdb1     2048  1050623  1048576  512M EFI System\n/dev/sdb2  1050624 60063710 59013087 28.1G Linux filesystem\n\nFilesystem/RAID signature on partition 1 will be wiped.\n",[709],{"type":20,"tag":45,"props":710,"children":711},{"__ignoreMap":7},[712,720,728,736,744,752,760,768,776,783,791,799,808,816],{"type":20,"tag":126,"props":713,"children":714},{"class":128,"line":129},[715],{"type":20,"tag":126,"props":716,"children":717},{},[718],{"type":25,"value":719},"Command (m for help): p\n",{"type":20,"tag":126,"props":721,"children":722},{"class":128,"line":265},[723],{"type":20,"tag":126,"props":724,"children":725},{},[726],{"type":25,"value":727},"Disk /dev/sdb: 28.66 GiB, 30752636928 bytes, 60063744 sectors\n",{"type":20,"tag":126,"props":729,"children":730},{"class":128,"line":274},[731],{"type":20,"tag":126,"props":732,"children":733},{},[734],{"type":25,"value":735},"Disk model: Ultra Fit\n",{"type":20,"tag":126,"props":737,"children":738},{"class":128,"line":284},[739],{"type":20,"tag":126,"props":740,"children":741},{},[742],{"type":25,"value":743},"Units: sectors of 1 * 512 = 512 bytes\n",{"type":20,"tag":126,"props":745,"children":746},{"class":128,"line":293},[747],{"type":20,"tag":126,"props":748,"children":749},{},[750],{"type":25,"value":751},"Sector size (logical/physical): 512 bytes / 512 bytes\n",{"type":20,"tag":126,"props":753,"children":754},{"class":128,"line":302},[755],{"type":20,"tag":126,"props":756,"children":757},{},[758],{"type":25,"value":759},"I/O size (minimum/optimal): 512 bytes / 512 bytes\n",{"type":20,"tag":126,"props":761,"children":762},{"class":128,"line":311},[763],{"type":20,"tag":126,"props":764,"children":765},{},[766],{"type":25,"value":767},"Disklabel type: gpt\n",{"type":20,"tag":126,"props":769,"children":770},{"class":128,"line":320},[771],{"type":20,"tag":126,"props":772,"children":773},{},[774],{"type":25,"value":775},"Disk identifier: E1D6C445-1B79-AB4D-A442-FA4AD6DF4ECC\n",{"type":20,"tag":126,"props":777,"children":778},{"class":128,"line":329},[779],{"type":20,"tag":126,"props":780,"children":781},{"emptyLinePlaceholder":278},[782],{"type":25,"value":281},{"type":20,"tag":126,"props":784,"children":785},{"class":128,"line":338},[786],{"type":20,"tag":126,"props":787,"children":788},{},[789],{"type":25,"value":790},"Device       Start      End  Sectors  Size Type\n",{"type":20,"tag":126,"props":792,"children":793},{"class":128,"line":347},[794],{"type":20,"tag":126,"props":795,"children":796},{},[797],{"type":25,"value":798},"/dev/sdb1     2048  1050623  1048576  512M EFI System\n",{"type":20,"tag":126,"props":800,"children":802},{"class":128,"line":801},12,[803],{"type":20,"tag":126,"props":804,"children":805},{},[806],{"type":25,"value":807},"/dev/sdb2  1050624 60063710 59013087 28.1G Linux filesystem\n",{"type":20,"tag":126,"props":809,"children":811},{"class":128,"line":810},13,[812],{"type":20,"tag":126,"props":813,"children":814},{"emptyLinePlaceholder":278},[815],{"type":25,"value":281},{"type":20,"tag":126,"props":817,"children":819},{"class":128,"line":818},14,[820],{"type":20,"tag":126,"props":821,"children":822},{},[823],{"type":25,"value":824},"Filesystem/RAID signature on partition 1 will be wiped.\n",{"type":20,"tag":675,"props":826,"children":828},{"id":827},"format-the-partitions",[829],{"type":25,"value":830},"Format the Partitions",{"type":20,"tag":21,"props":832,"children":833},{},[834,836],{"type":25,"value":835},"The UEFI specification mandates support for FAT file-systems, and FAT32 is\nrecommended for removable media. ",{"type":20,"tag":54,"props":837,"children":838},{},[839],{"type":20,"tag":58,"props":840,"children":843},{"href":841,"rel":842},"https://wiki.archlinux.org/index.php/EFI_system_partition#Format_the_partition",[62],[844],{"type":25,"value":845},"7",{"type":20,"tag":116,"props":847,"children":849},{"code":848,"language":119,"meta":7,"className":120,"style":7},"[root@archlinux ~]# pacman -Sy dosfstools\n[root@archlinux ~]# mkfs.fat -F32 /dev/sdb1\n",[850],{"type":20,"tag":45,"props":851,"children":852},{"__ignoreMap":7},[853,869],{"type":20,"tag":126,"props":854,"children":855},{"class":128,"line":129},[856,860,864],{"type":20,"tag":126,"props":857,"children":858},{"style":434},[859],{"type":25,"value":695},{"type":20,"tag":126,"props":861,"children":862},{"style":440},[863],{"type":25,"value":443},{"type":20,"tag":126,"props":865,"children":866},{"style":434},[867],{"type":25,"value":868},"]# pacman -Sy dosfstools\n",{"type":20,"tag":126,"props":870,"children":871},{"class":128,"line":265},[872,876,880],{"type":20,"tag":126,"props":873,"children":874},{"style":434},[875],{"type":25,"value":695},{"type":20,"tag":126,"props":877,"children":878},{"style":440},[879],{"type":25,"value":443},{"type":20,"tag":126,"props":881,"children":882},{"style":434},[883],{"type":25,"value":884},"]# mkfs.fat -F32 /dev/sdb1\n",{"type":20,"tag":21,"props":886,"children":887},{},[888,890,896,898],{"type":25,"value":889},"As for the root partition, it is recommended to use ",{"type":20,"tag":45,"props":891,"children":893},{"className":892},[],[894],{"type":25,"value":895},"ext4",{"type":25,"value":897}," without a journal to\nreduce the reads and writes to the file-system as this is detrimental to the\nflash-based USB drive. ",{"type":20,"tag":54,"props":899,"children":900},{},[901],{"type":20,"tag":58,"props":902,"children":905},{"href":903,"rel":904},"https://wiki.archlinux.org/index.php/Install_Arch_Linux_on_a_USB_key#Installation_tweaks",[62],[906],{"type":25,"value":907},"8",{"type":20,"tag":116,"props":909,"children":911},{"code":910,"language":119,"meta":7,"className":120,"style":7},"[root@archlinux ~]# mkfs.ext4 -O \"^has_journal\" /dev/sdb2\n",[912],{"type":20,"tag":45,"props":913,"children":914},{"__ignoreMap":7},[915],{"type":20,"tag":126,"props":916,"children":917},{"class":128,"line":129},[918,922,926,931,936],{"type":20,"tag":126,"props":919,"children":920},{"style":434},[921],{"type":25,"value":695},{"type":20,"tag":126,"props":923,"children":924},{"style":440},[925],{"type":25,"value":443},{"type":20,"tag":126,"props":927,"children":928},{"style":434},[929],{"type":25,"value":930},"]# mkfs.ext4 -O ",{"type":20,"tag":126,"props":932,"children":933},{"style":138},[934],{"type":25,"value":935},"\"^has_journal\"",{"type":20,"tag":126,"props":937,"children":938},{"style":434},[939],{"type":25,"value":940}," /dev/sdb2\n",{"type":20,"tag":675,"props":942,"children":944},{"id":943},"mount-the-partitions-and-bootstrap-the-environment",[945],{"type":25,"value":946},"Mount the Partitions and Bootstrap the Environment",{"type":20,"tag":116,"props":948,"children":950},{"code":949,"language":119,"meta":7,"className":120,"style":7},"[root@archlinux ~]# mount /dev/sdb2 /mnt\n[root@archlinux ~]# mkdir -p /mnt/boot/efi\n[root@archlinux ~]# mount /dev/sdb1 /mnt/boot/efi\n",[951],{"type":20,"tag":45,"props":952,"children":953},{"__ignoreMap":7},[954,970,986],{"type":20,"tag":126,"props":955,"children":956},{"class":128,"line":129},[957,961,965],{"type":20,"tag":126,"props":958,"children":959},{"style":434},[960],{"type":25,"value":695},{"type":20,"tag":126,"props":962,"children":963},{"style":440},[964],{"type":25,"value":443},{"type":20,"tag":126,"props":966,"children":967},{"style":434},[968],{"type":25,"value":969},"]# mount /dev/sdb2 /mnt\n",{"type":20,"tag":126,"props":971,"children":972},{"class":128,"line":265},[973,977,981],{"type":20,"tag":126,"props":974,"children":975},{"style":434},[976],{"type":25,"value":695},{"type":20,"tag":126,"props":978,"children":979},{"style":440},[980],{"type":25,"value":443},{"type":20,"tag":126,"props":982,"children":983},{"style":434},[984],{"type":25,"value":985},"]# mkdir -p /mnt/boot/efi\n",{"type":20,"tag":126,"props":987,"children":988},{"class":128,"line":274},[989,993,997],{"type":20,"tag":126,"props":990,"children":991},{"style":434},[992],{"type":25,"value":695},{"type":20,"tag":126,"props":994,"children":995},{"style":440},[996],{"type":25,"value":443},{"type":20,"tag":126,"props":998,"children":999},{"style":434},[1000],{"type":25,"value":1001},"]# mount /dev/sdb1 /mnt/boot/efi\n",{"type":20,"tag":116,"props":1003,"children":1005},{"code":1004,"language":119,"meta":7,"className":120,"style":7},"[root@archlinux ~]# pacman -S arch-install-scripts\n[root@archlinux ~]# pacstrap /mnt base linux linux-firmware\n[root@archlinux ~]# genfstab -U /mnt >> /mnt/etc/fstab\n",[1006],{"type":20,"tag":45,"props":1007,"children":1008},{"__ignoreMap":7},[1009,1025,1041],{"type":20,"tag":126,"props":1010,"children":1011},{"class":128,"line":129},[1012,1016,1020],{"type":20,"tag":126,"props":1013,"children":1014},{"style":434},[1015],{"type":25,"value":695},{"type":20,"tag":126,"props":1017,"children":1018},{"style":440},[1019],{"type":25,"value":443},{"type":20,"tag":126,"props":1021,"children":1022},{"style":434},[1023],{"type":25,"value":1024},"]# pacman -S arch-install-scripts\n",{"type":20,"tag":126,"props":1026,"children":1027},{"class":128,"line":265},[1028,1032,1036],{"type":20,"tag":126,"props":1029,"children":1030},{"style":434},[1031],{"type":25,"value":695},{"type":20,"tag":126,"props":1033,"children":1034},{"style":440},[1035],{"type":25,"value":443},{"type":20,"tag":126,"props":1037,"children":1038},{"style":434},[1039],{"type":25,"value":1040},"]# pacstrap /mnt base linux linux-firmware\n",{"type":20,"tag":126,"props":1042,"children":1043},{"class":128,"line":274},[1044,1048,1052,1057,1062],{"type":20,"tag":126,"props":1045,"children":1046},{"style":434},[1047],{"type":25,"value":695},{"type":20,"tag":126,"props":1049,"children":1050},{"style":440},[1051],{"type":25,"value":443},{"type":20,"tag":126,"props":1053,"children":1054},{"style":434},[1055],{"type":25,"value":1056},"]# genfstab -U /mnt ",{"type":20,"tag":126,"props":1058,"children":1059},{"style":440},[1060],{"type":25,"value":1061},">>",{"type":20,"tag":126,"props":1063,"children":1064},{"style":434},[1065],{"type":25,"value":1066}," /mnt/etc/fstab\n",{"type":20,"tag":675,"props":1068,"children":1070},{"id":1069},"configure-the-new-environment",[1071],{"type":25,"value":1072},"Configure the New Environment",{"type":20,"tag":116,"props":1074,"children":1076},{"code":1075},"[root@archlinux ~]# arch-chroot /mnt\n",[1077],{"type":20,"tag":45,"props":1078,"children":1079},{"__ignoreMap":7},[1080],{"type":25,"value":1075},{"type":20,"tag":116,"props":1082,"children":1084},{"code":1083},"[root@archlinux /]# ln -sf /usr/share/zoneinfo/US/Eastern /etc/localtime\n[root@archlinux /]# hwclock --systohc\n[root@archlinux /]# sed -i 's/#en_US.UTF-8/en_US.UTF-8/' /etc/locale.gen\n[root@archlinux /]# locale-gen\n[root@archlinux /]# echo \"LANG=en_US.UTF-8\" > /etc/locale.conf\n",[1085],{"type":20,"tag":45,"props":1086,"children":1087},{"__ignoreMap":7},[1088],{"type":25,"value":1083},{"type":20,"tag":116,"props":1090,"children":1092},{"code":1091},"[root@archlinux /]# hostnamectl set-hostname usb\n[root@archlinux /]# echo \"127.0.0.1        localhost\" >> /etc/hosts\n[root@archlinux /]# echo \"::1              localhost\" >> /etc/hosts\n",[1093],{"type":20,"tag":45,"props":1094,"children":1095},{"__ignoreMap":7},[1096],{"type":25,"value":1091},{"type":20,"tag":21,"props":1098,"children":1099},{},[1100,1102,1108,1110],{"type":25,"value":1101},"Note, one difference here from a standard installation is that the\n",{"type":20,"tag":45,"props":1103,"children":1105},{"className":1104},[],[1106],{"type":25,"value":1107},"--removable",{"type":25,"value":1109}," flag is specified when installing the GRUB bootloader.\n",{"type":20,"tag":54,"props":1111,"children":1112},{},[1113],{"type":20,"tag":58,"props":1114,"children":1117},{"href":1115,"rel":1116},"https://wiki.archlinux.org/index.php/GRUB#UEFI_systems",[62],[1118],{"type":25,"value":1119},"10",{"type":20,"tag":116,"props":1121,"children":1123},{"code":1122},"[root@archlinux /]# pacman -S grub\n[root@archlinux /]# grub-install --target=x86_64-efi --efi-directory=/boot/efi  --removable --recheck\n[root@usb /]# grub-mkconfig -o /boot/grub/grub.cfg\n",[1124],{"type":20,"tag":45,"props":1125,"children":1126},{"__ignoreMap":7},[1127],{"type":25,"value":1122},{"type":20,"tag":21,"props":1129,"children":1130},{},[1131],{"type":25,"value":1132},"Shutdown the virtual machine, restart the host machine, and boot the newly\ncreated Arch Linux thumb-drive!",{"type":20,"tag":21,"props":1134,"children":1135},{},[1136],{"type":25,"value":1137},"🎉",{"type":20,"tag":92,"props":1139,"children":1141},{"id":1140},"side-note",[1142],{"type":25,"value":1143},"Side-note",{"type":20,"tag":21,"props":1145,"children":1146},{},[1147,1149,1155,1157,1162,1164],{"type":25,"value":1148},"It was attempted to use the ",{"type":20,"tag":45,"props":1150,"children":1152},{"className":1151},[],[1153],{"type":25,"value":1154},"controlvm usbattach",{"type":25,"value":1156}," command to pass the USB\ndevice to the guest machine, but this did not work as it expects the virtual\nmachine to already be running, and the ",{"type":20,"tag":45,"props":1158,"children":1160},{"className":1159},[],[1161],{"type":25,"value":236},{"type":25,"value":1163}," option runs prior to\nbooting the machine. ",{"type":20,"tag":54,"props":1165,"children":1166},{},[1167],{"type":20,"tag":58,"props":1168,"children":1171},{"href":1169,"rel":1170},"https://www.vagrantup.com/docs/virtualbox/configuration.html#vboxmanage-customizations",[62],[1172],{"type":25,"value":1173},"11",{"type":20,"tag":116,"props":1175,"children":1177},{"code":1176,"language":249,"meta":7,"className":250,"style":7},"Command: [\"controlvm\", \"060a716b-1965-49e2-bc56-12beed5df716\", \"usbattach36fc9e60-c465-11cf-8056-444553540000\"]\n\nStderr: VBoxManage.exe: error: Machine '060a716b-1965-49e2-bc56-12beed5df716' is not currently running.\n",[1178],{"type":20,"tag":45,"props":1179,"children":1180},{"__ignoreMap":7},[1181,1189,1196],{"type":20,"tag":126,"props":1182,"children":1183},{"class":128,"line":129},[1184],{"type":20,"tag":126,"props":1185,"children":1186},{},[1187],{"type":25,"value":1188},"Command: [\"controlvm\", \"060a716b-1965-49e2-bc56-12beed5df716\", \"usbattach36fc9e60-c465-11cf-8056-444553540000\"]\n",{"type":20,"tag":126,"props":1190,"children":1191},{"class":128,"line":265},[1192],{"type":20,"tag":126,"props":1193,"children":1194},{"emptyLinePlaceholder":278},[1195],{"type":25,"value":281},{"type":20,"tag":126,"props":1197,"children":1198},{"class":128,"line":274},[1199],{"type":20,"tag":126,"props":1200,"children":1201},{},[1202],{"type":25,"value":1203},"Stderr: VBoxManage.exe: error: Machine '060a716b-1965-49e2-bc56-12beed5df716' is not currently running.\n",{"type":20,"tag":92,"props":1205,"children":1207},{"id":1206},"references",[1208],{"type":25,"value":1209},"References",{"type":20,"tag":1211,"props":1212,"children":1213},"ol",{},[1214,1224,1233,1242,1251,1260,1269,1278,1287,1296,1305],{"type":20,"tag":1215,"props":1216,"children":1217},"li",{},[1218],{"type":20,"tag":58,"props":1219,"children":1221},{"href":60,"rel":1220},[62],[1222],{"type":25,"value":1223},"Docker Desktop on Mac vs. Docker Toolbox",{"type":20,"tag":1215,"props":1225,"children":1226},{},[1227],{"type":20,"tag":58,"props":1228,"children":1230},{"href":70,"rel":1229},[62],[1231],{"type":25,"value":1232},"GitHub - HyperKit",{"type":20,"tag":1215,"props":1234,"children":1235},{},[1236],{"type":20,"tag":58,"props":1237,"children":1239},{"href":78,"rel":1238},[62],[1240],{"type":25,"value":1241},"GitHub - Docker for Mac - Issue #900",{"type":20,"tag":1215,"props":1243,"children":1244},{},[1245],{"type":20,"tag":58,"props":1246,"children":1248},{"href":108,"rel":1247},[62],[1249],{"type":25,"value":1250},"Vagrant Cloud - Arch Linux",{"type":20,"tag":1215,"props":1252,"children":1253},{},[1254],{"type":20,"tag":58,"props":1255,"children":1257},{"href":216,"rel":1256},[62],[1258],{"type":25,"value":1259},"Attaching USB Devices to VirtualBox Guests using VBoxManage",{"type":20,"tag":1215,"props":1261,"children":1262},{},[1263],{"type":20,"tag":58,"props":1264,"children":1266},{"href":224,"rel":1265},[62],[1267],{"type":25,"value":1268},"GitHub Gist - Vagrant USB Filter",{"type":20,"tag":1215,"props":1270,"children":1271},{},[1272],{"type":20,"tag":58,"props":1273,"children":1275},{"href":841,"rel":1274},[62],[1276],{"type":25,"value":1277},"Arch Linux Wiki - EFI System Partition - Format Partitions",{"type":20,"tag":1215,"props":1279,"children":1280},{},[1281],{"type":20,"tag":58,"props":1282,"children":1284},{"href":903,"rel":1283},[62],[1285],{"type":25,"value":1286},"Arch Linux Wiki - Arch Linux on USB - Installation Tweaks",{"type":20,"tag":1215,"props":1288,"children":1289},{},[1290],{"type":20,"tag":58,"props":1291,"children":1293},{"href":667,"rel":1292},[62],[1294],{"type":25,"value":1295},"Arch Linux Wiki - Installation Guide",{"type":20,"tag":1215,"props":1297,"children":1298},{},[1299],{"type":20,"tag":58,"props":1300,"children":1302},{"href":1115,"rel":1301},[62],[1303],{"type":25,"value":1304},"Arch Linux Wiki - GRUB - UEFI Systems",{"type":20,"tag":1215,"props":1306,"children":1307},{},[1308],{"type":20,"tag":58,"props":1309,"children":1311},{"href":1169,"rel":1310},[62],[1312],{"type":25,"value":1313},"Vagrant VBoxManage Customizations ",{"type":20,"tag":1315,"props":1316,"children":1317},"style",{},[1318],{"type":25,"value":1319},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":7,"searchDepth":265,"depth":265,"links":1321},[1322,1323,1329,1330],{"id":94,"depth":265,"text":97},{"id":656,"depth":265,"text":659,"children":1324},[1325,1326,1327,1328],{"id":677,"depth":274,"text":680},{"id":827,"depth":274,"text":830},{"id":943,"depth":274,"text":946},{"id":1069,"depth":274,"text":1072},{"id":1140,"depth":265,"text":1143},{"id":1206,"depth":265,"text":1209},"markdown","content:articles:persistent-archlinux-usb.md","content","articles/persistent-archlinux-usb.md","articles/persistent-archlinux-usb","md",1720229315500]